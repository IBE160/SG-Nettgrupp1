<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.3</storyId>
    <title>Admin Interface for Basic Product Management</title>
    <status>Draft</status>
    <generatedAt>2025-11-20</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>.bmad-ephemeral/stories/1-3-admin-interface-for-basic-product-management.md</sourceStoryPath>
  </metadata>
  <story>
    <asA>a Business Owner</asA>
    <iWant>to add, edit, and view basic product information (name, description, price, stock)</iWant>
    <soThat>I can manage the product catalog</soThat>
    <tasks>
      <task id="1">Create Admin Login Page (FR020)</task>
      <task id="2">Create Admin Dashboard Page</task>
      <task id="3">Implement "Add Product" Functionality (FR013)</task>
      <task id="4">Implement "Edit Product" Functionality</task>
    </tasks>
  </story>
  <acceptanceCriteria>
      <criterion id="1">A secure admin login page is implemented (FR020).</criterion>
      <criterion id="2">After logging in, I can access a page to add new products with name, description, price, and initial stock (FR013).</criterion>
      <criterion id="3">I can edit an existing product's name, description, price, and stock.</criterion>
      <criterion id="4">I can view a list of all products with their basic details.</criterion>
  </acceptanceCriteria>
  <artifacts>
    <docs>
      <doc path=".bmad-ephemeral/stories/tech-spec-epic-1.md" title="Epic 1 Technical Specification" section="APIs and Interfaces" snippet="Defines the POST /api/products and PUT /api/products/:id endpoints that must be implemented and protected in this story."/>
      <doc path="docs/architecture.md" title="Architecture" section="Security Architecture" snippet="Authentication: Supabase Auth for secure admin login. Authorization: Role-based access control (RBAC) to be implemented..."/>
      <doc path="docs/PRD.md" title="Product Requirements Document" section="Functional Requirements" snippet="FR020: The admin interface shall support authenticated login. FR013: The system shall provide an admin interface for the business owner to add new products."/>
    </docs>
    <code>
      <file path="src/pages/LoginPage.jsx" kind="new-component" reason="The main component for the admin login UI."/>
      <file path="src/pages/AdminDashboard.jsx" kind="new-component" reason="The main component for displaying and managing products."/>
      <file path="api/middleware/auth.js" kind="new-middleware" reason="Backend middleware to protect admin routes by verifying Supabase JWTs."/>
      <file path="api/controllers/products.js" kind="modified-controller" reason="Will be modified to add the POST and PUT request handlers."/>
    </code>
    <dependencies>
        <dependency name="react" version="^18.2.0" type="npm" reason="Core frontend framework."/>
        <dependency name="react-router-dom" version="^7.9.6" type="npm" reason="Needed for creating the protected /admin route."/>
        <dependency name="@supabase/supabase-js" version="^2.81.1" type="npm" reason="Will be used on the frontend for `signInWithPassword` and on the backend to validate tokens."/>
    </dependencies>
  </artifacts>
  <constraints>
    <constraint type="pattern" source="docs/architecture.md">UI components should be built using the `shadcn/ui` library (e.g., Card, Input, Button, Table, Dialog).</constraint>
    <constraint type="pattern" source="docs/architecture.md">Admin-only API endpoints (`POST`, `PUT` on `/api/products`) MUST be protected by authentication middleware.</constraint>
  </constraints>
  <interfaces>
      <interface name="signInWithPassword" kind="Supabase Auth function" signature="supabase.auth.signInWithPassword({ email, password })" path="@supabase/supabase-js" reason="Primary method for authenticating the admin user."/>
      <interface name="POST /api/products" kind="REST endpoint" signature="POST /api/products" path="api/routes/products.js" reason="Endpoint for creating a new product. Must be authenticated."/>
      <interface name="PUT /api/products/:id" kind="REST endpoint" signature="PUT /api/products/:id" path="api/routes/products.js" reason="Endpoint for updating an existing product. Must be authenticated."/>
  </interfaces>
  <tests>
    <standards>E2E tests are critical for this story to validate the complete login and CRUD flow. [Source: .bmad-ephemeral/stories/tech-spec-epic-1.md]</standards>
    <locations>
      <location type="e2e">/tests/e2e/admin.spec.ts</location>
    </locations>
    <ideas>
      <idea ac_id="1">Write an E2E test that navigates to `/admin`, asserts a redirect to `/login`, and then fails a login attempt with bad credentials.</idea>
      <idea ac_id="2-4">Write a full E2E test that logs in, creates a new product, verifies it appears in the table, edits it, and verifies the changes.</idea>
    </ideas>
  </tests>
</story-context>
