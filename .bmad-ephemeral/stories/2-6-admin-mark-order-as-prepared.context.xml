<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>2.6</storyId>
    <title>Admin Mark Order as Prepared</title>
    <status>Draft</status>
    <generatedAt>2025-11-20</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>.bmad-ephemeral/stories/2-6-admin-mark-order-as-prepared.md</sourceStoryPath>
  </metadata>
  <story>
    <asA>a Business Owner</asA>
    <iWant>to update the status of an order to "Prepared"</iWant>
    <soThat>I can track its preparation and notify the customer</soThat>
    <tasks>
        <task id="1">Backend API for Status Update</task>
        <task id="2">Email Notification</task>
        <task id="3">Frontend Button</task>
    </tasks>
  </story>
  <acceptanceCriteria>
      <criterion id="1">From the order detail view in the admin interface, a button/action exists to "Mark as Prepared".</criterion>
      <criterion id="2">Clicking this action changes the order status to "Prepared" (FR011).</criterion>
      <criterion id="3">The system automatically sends a "Ready for Pickup" email notification to the customer (FR019).</criterion>
  </acceptanceCriteria>
  <artifacts>
    <code>
        <file path="src/pages/AdminOrderDetailPage.jsx" kind="modified-component" reason="Will be modified to add the status update button."/>
        <file path="api/controllers/orders.js" kind="modified-controller" reason="Will be modified to add the PUT handler for status updates."/>
    </code>
    <dependencies>
        <dependency name="resend" version="6.4.2" type="npm" reason="The email service for notifying the customer."/>
    </dependencies>
  </artifacts>
  <constraints/>
  <interfaces>
      <interface name="PUT /api/orders/:id" kind="REST endpoint" signature="PUT /api/orders/:id" path="api/routes/orders.js" reason="To update the status of an order."/>
  </interfaces>
  <tests>
    <ideas>
      <idea ac_id="1-3">Write an E2E test where an admin views an order, clicks 'Mark as Prepared', and verifies the status updates on the page. An integration test should verify the email sending logic.</idea>
    </ideas>
  </tests>
</story-context>
